<%- include('../partials/header') %>

<div class="dashboard-banner" style="background: linear-gradient(135deg, #1f2937, #111827);">
    <div class="banner-title" style="background: linear-gradient(90deg, #60a5fa, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Reading Content Manager</div>
    <div class="banner-subtitle">Add and manage reading comprehension passages.</div>
</div>

<div class="cards-grid" style="grid-template-columns: 1fr 1fr;">

    <!-- Add New Content -->
    <div class="quiz-card">
        <h3 style="color:white; margin-top:0;">Add New Passage</h3>
        <p style="color: #8b949e; font-size: 0.85rem;">Format: Title (#), Content, Q1-Q5 with options, Answer (Ans: x) and Explanation (Exp: ...)</p>
        
        <form action="/reading/admin/add" method="POST">
            <textarea name="rawContent" rows="20" required
                style="width: 100%; height: 400px; background: #0d1117; border: 1px solid #30363d; color: #c9d1d9; border-radius: 6px; padding: 15px; font-family: monospace; font-size: 0.9rem; line-height: 1.5;"
                placeholder="# Title Here
Passage text here...

Q1. Question text?
a) Option 1
b) Option 2
c) Option 3
d) Option 4
Ans: a
Exp: Explanation...

Q2. ... (Must equate to exactly 5 questions)"></textarea>
            
            <button type="submit" class="btn btn-primary" style="margin-top: 15px; width: 100%;">Parse & Save Passage</button>
        </form>

        <div style="margin-top: 20px; background: rgba(56, 139, 253, 0.1); border: 1px solid rgba(56, 139, 253, 0.3); padding: 15px; border-radius: 6px; font-size: 0.85rem; color: #c9d1d9;">
            <strong style="color: #58a6ff;">Required Format:</strong>
            <pre style="background: #0d1117; padding: 10px; border-radius: 4px; border: 1px solid #30363d; overflow-x: auto; margin-top: 10px; color: #8b949e;"># The Solar System
The solar system consisting of the Sun... [Passage Text]

Q1. What is the center of the solar system?
a) Earth
b) Sun
c) Mars
d) Jupiter
Ans: b
Exp: The Sun is the star at the center...</pre>
        </div>
    </div>

    <!-- manage Panel -->
    <div class="quiz-card">
        <h3 style="color:white; margin-top:0;">Existing Passages</h3>
        
        <div style="max-height: 500px; overflow-y: auto;">
            <% if(passages.length === 0) { %>
                <p style="color: #8b949e;">No passages found.</p>
            <% } %>

            <% passages.forEach(p => { %>
                <div style="background: #0d1117; padding: 15px; border-radius: 6px; border: 1px solid #30363d; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <h4 style="color: #e6edf3; margin: 0 0 5px 0;"><%= p.title %></h4>
                            <p style="color: #8b949e; margin: 0; font-size: 0.8rem;">
                                <%= p.content.substring(0, 60) %>...
                            </p>
                            <div style="margin-top: 5px;">
                                <span style="font-size: 0.7rem; background: #1f6feb; color: white; padding: 2px 6px; border-radius: 4px;"><%= p.questions.length %> Qs</span>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 5px; flex-direction: column; align-items: flex-end;">
                            <form action="/reading/admin/toggle/<%= p._id %>" method="POST" style="margin:0;">
                                <button type="submit" 
                                    style="padding: 4px 8px; border-radius: 4px; border: none; font-size:0.7rem; font-weight: bold; cursor: pointer; background: <%= p.isActive ? 'rgba(46, 160, 67, 0.2)' : 'rgba(218, 54, 51, 0.2)' %>; color: <%= p.isActive ? '#3fb950' : '#ff7b72' %>;">
                                    <%= p.isActive ? 'ACTIVE' : 'INACTIVE' %>
                                </button>
                            </form>
                            <form action="/reading/admin/delete/<%= p._id %>" method="POST" style="margin:0;" onsubmit="return confirm('Delete this passage?');">
                                <button style="background: none; border: none; cursor: pointer; color: #ff7b72;">üóëÔ∏è</button>
                            </form>
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>

        <!-- Pagination -->
        <% if (typeof totalPages !== 'undefined' && totalPages > 1) { %>
        <div style="display: flex; justify-content: center; padding-top: 20px; gap: 10px; border-top: 1px solid #30363d; margin-top: 20px;">
            <% if (currentPage > 1) { %>
                <a href="?page=<%= currentPage - 1 %>" style="background: transparent; border: 1px solid #30363d; color: #c9d1d9; padding: 4px 10px; border-radius: 6px; text-decoration: none; font-size: 0.85rem;">&larr; Prev</a>
            <% } %>
            
            <span style="background: #161b22; border: 1px solid #30363d; color: #58a6ff; padding: 4px 10px; border-radius: 6px; font-size: 0.85rem;">
                <%= currentPage %> / <%= totalPages %>
            </span>

            <% if (currentPage < totalPages) { %>
                <a href="?page=<%= currentPage + 1 %>" style="background: transparent; border: 1px solid #30363d; color: #c9d1d9; padding: 4px 10px; border-radius: 6px; text-decoration: none; font-size: 0.85rem;">Next &rarr;</a>
            <% } %>
        </div>
        <% } %>
    </div>

</div>

<%- include('../partials/footer') %>
