<%- include("../../partials/header") %>

<div class="dashboard-banner" style="background: linear-gradient(135deg, #a855f7 0%, #d946ef 100%); padding: 60px 20px; text-align: center; color: white;">
    <div class="banner-title" style="font-size: 2.5rem; font-weight: 800; margin-bottom: 10px;">University Exams (Admin)</div>
    <div class="banner-subtitle" style="font-size: 1.2rem; opacity: 0.9;">Create and manage high-stakes online examinations.</div>
</div>

<div style="max-width: 1200px; margin: 0 auto; padding: 40px 20px;">
    
    <!-- Action Bar -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2 style="color: var(--text-primary); margin: 0; font-size: 1.8rem;">Exam List</h2>
        <a href="/exams/admin/create" class="btn-primary-custom">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            Create New Exam
        </a>
    </div>

    <!-- Stats/Exam Cards -->
    <% if (exams && exams.length > 0) { %>
        <div class="exam-grid">
            <% exams.forEach(function(exam) { %>
                <div class="exam-card">
                    <div class="exam-header-row">
                        <h3 class="exam-title"><%= exam.title %></h3>
                        <% 
                            const now = new Date();
                            const start = new Date(exam.startTime);
                            const end = new Date(exam.endTime);
                            let statusClass = "badge-upcoming";
                            let statusText = "Upcoming";

                            if (now >= start && now <= end) {
                                statusClass = "badge-live";
                                statusText = "Live Now";
                            } else if (now > end) {
                                statusClass = "badge-ended";
                                statusText = "Ended";
                            }
                        %>
                        <span class="status-badge <%= statusClass %>"><%= statusText %></span>
                    </div>
                    
                    <div class="exam-details">
                        <div class="detail-item">
                            <span class="icon"></span> 
                            <%= new Date(exam.date).toLocaleDateString() %>
                        </div>
                        <div class="detail-item">
                            <span class="icon"></span>
                            <%= start.toLocaleTimeString([], {hour: "2-digit", minute:"2-digit"}) %> - 
                            <%= end.toLocaleTimeString([], {hour: "2-digit", minute:"2-digit"}) %>
                        </div>
                    </div>

                    <div style="color: var(--text-secondary); margin: 15px 0; font-size: 0.9rem; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                        <%= exam.instructions %>
                    </div>

                    <div class="exam-actions">
                        <a href="/exams/<%= exam._id %>/attempt" target="_blank" class="action-btn">
                            Preview Paper
                        </a>
                        <a href="/exams/admin/registrations/<%= exam._id %>" class="action-btn" style="background: rgba(31, 111, 235, 0.1); color: #58a6ff; border-color: rgba(56, 139, 253, 0.4);">
                            View Registrations
                        </a>
                        <span style="color: #484f58; font-size: 0.8rem;">ID: ...<%= exam._id.toString().slice(-6) %></span>
                    </div>
                    
                    <div style="margin-top: 15px; border-top: 1px solid var(--border-color); padding-top: 10px; display: flex; gap: 10px;">
                        <a href="/exams/admin/edit/<%= exam._id %>" style="color: #a855f7; text-decoration: none; font-size: 0.9rem;">
                            ‚úèÔ∏è Edit
                        </a>
                        <form action="/exams/admin/delete/<%= exam._id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this exam? This will also delete all student registrations for this exam.');" style="margin-left: auto;">
                            <button type="submit" style="background: none; border: none; color: #f85149; font-size: 0.9rem; cursor: pointer;">
                                üóëÔ∏è Delete
                            </button>
                        </form>
                    </div>
                </div>
            <% }); %>
        </div>
    <% } else { %>
        <div style="text-align: center; padding: 60px; border: 1px dashed #30363d; border-radius: 12px; color: var(--text-secondary); background: #0d1117;">
            <div style="font-size: 40px; margin-bottom: 20px;"></div>
            <h3>No exams created yet</h3>
            <p>Click the "Create New Exam" button to get started.</p>
        </div>
    <% } %>

</div>

<style>
    :root {
        --card-bg: #161b22;
        --border-color: #30363d;
        --text-primary: #e6edf3;
        --text-secondary: #8b949e;
    }

    .btn-primary-custom {
        background-color: #238636;
        color: white;
        padding: 10px 20px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        border: 1px solid rgba(240, 246, 252, 0.1);
        transition: 0.2s;
    }
    .btn-primary-custom:hover {
        background-color: #2ea043;
        text-decoration: none;
        color: white;
    }

    .exam-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
    }

    .exam-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 25px;
        transition: transform 0.2s, border-color 0.2s;
    }
    .exam-card:hover {
        border-color: #8b949e;
        transform: translateY(-2px);
    }

    .exam-header-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
    }

    .exam-title {
        color: #58a6ff;
        margin: 0;
        font-size: 1.3rem;
        font-weight: 600;
        line-height: 1.3;
    }

    .status-badge {
        font-size: 0.75rem;
        padding: 4px 10px;
        border-radius: 20px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        white-space: nowrap;
        margin-left: 10px;
    }
    .badge-upcoming {
        background: rgba(56, 139, 253, 0.15);
        color: #58a6ff;
        border: 1px solid rgba(56, 139, 253, 0.4);
    }
    .badge-live {
        background: rgba(46, 160, 67, 0.15);
        color: #3fb950;
        border: 1px solid rgba(46, 160, 67, 0.4);
        box-shadow: 0 0 0 2px rgba(46, 160, 67, 0.2);
    }
    .badge-ended {
        background: rgba(110, 118, 129, 0.15);
        color: #8b949e;
        border: 1px solid rgba(110, 118, 129, 0.4);
    }

    .exam-details {
        display: flex;
        gap: 20px;
        color: var(--text-primary);
        font-size: 0.95rem;
        background: #0d1117;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #21262d;
    }
    .detail-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .exam-actions {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .action-btn {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 0.9rem;
        padding: 8px 16px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        transition: 0.2s;
    }
    .action-btn:hover {
        background: #30363d;
        color: white;
        text-decoration: none;
    }
</style>

<%- include("../../partials/footer") %>
